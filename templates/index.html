<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForestGuard AI | Deforestation Detection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Theme Toggle Button -->
    <div class="theme-toggle">
        <button id="theme-switch">
            <i class="fas fa-sun light-icon"></i>
            <i class="fas fa-moon dark-icon"></i>
        </button>
    </div>

    <!-- Header Section -->
    <header>
        <div class="logo">
            <span class="logo-icon"><i class="fas fa-tree"></i></span>
            <span class="logo-text">ForestGuard AI</span>
        </div>
        <nav>
            <ul>
                <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="#about"><i class="fas fa-info-circle"></i> About</a></li>
                <li><a href="#location-analysis"><i class="fas fa-map-marker-alt"></i> Location</a></li>
                <li><a href="#upload"><i class="fas fa-upload"></i> Upload</a></li>
                <li><a href="#contact"><i class="fas fa-envelope"></i> Contact</a></li>
            </ul>
        </nav>
        <div class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Protecting Forests with <span class="accent">AI Technology</span></h1>
            <p>Detect deforestation in real-time using advanced satellite image analysis and machine learning.</p>
            <div class="hero-buttons">
                <a href="#location-analysis" class="btn primary-btn"><i class="fas fa-map-marker-alt"></i> Analyze Location</a>
                <a href="#upload" class="btn secondary-btn"><i class="fas fa-upload"></i> Upload Image</a>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <h2><i class="fas fa-seedling"></i> Our Mission</h2>
            <div class="mission-content">
                <div class="mission-text">
                    <p>ForestGuard AI uses advanced deep learning algorithms to identify deforestation patterns in satellite imagery. Our technology helps environmental agencies, researchers, and activists monitor forest health and prevent illegal logging activities.</p>
                </div>
                <div class="statistics">
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <h3>95%</h3>
                        <p>Detection Accuracy</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-globe-americas"></i>
                        <h3>15M+</h3>
                        <p>Hectares Monitored</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-tree"></i>
                        <h3>60K+</h3>
                        <p>Forests Protected</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Location Analysis Section -->
    <section id="location-analysis" class="location-section">
        <div class="container">
            <h2><i class="fas fa-map-marker-alt"></i> Analyze Specific Location</h2>
            <div class="location-container">
                <div class="location-input-section">
                    <h3><i class="fas fa-crosshairs"></i> Enter Coordinates</h3>
                    <div class="coordinate-inputs">
                        <div class="input-group">
                            <label for="latitude">Latitude:</label>
                            <input type="number" id="latitude" step="any" placeholder="e.g., -3.4653" min="-90" max="90">
                        </div>
                        <div class="input-group">
                            <label for="longitude">Longitude:</label>
                            <input type="number" id="longitude" step="any" placeholder="e.g., -62.2159" min="-180" max="180">
                        </div>
                        <div class="input-group">
                            <label for="zoom-level">Zoom Level:</label>
                            <select id="zoom-level">
                                <option value="12">12 - Regional View</option>
                                <option value="13">13 - Area View</option>
                                <option value="14">14 - Local View</option>
                                <option value="15" selected>15 - Detailed View</option>
                                <option value="16">16 - Close View</option>
                                <option value="17">17 - Very Close</option>
                            </select>
                        </div>
                    </div>
                    <div class="location-buttons">
                        <button id="show-on-map" class="btn secondary-btn">
                            <i class="fas fa-map"></i> Show on Map
                        </button>
                        <button id="analyze-location" class="btn primary-btn">
                            <i class="fas fa-satellite"></i> Analyze Location
                        </button>
                    </div>
                    <div class="quick-locations">
                        <h4><i class="fas fa-star"></i> Quick Locations</h4>
                        <div class="quick-location-buttons">
                            <button class="quick-location-btn" data-lat="-3.4653" data-lon="-62.2159">Amazon Rainforest</button>
                            <button class="quick-location-btn" data-lat="0.7893" data-lon="113.9213">Borneo</button>
                            <button class="quick-location-btn" data-lat="-0.7893" data-lon="11.6094">Congo Basin</button>
                            <button class="quick-location-btn" data-lat="61.5240" data-lon="105.3188">Siberian Forest</button>
                        </div>
                    </div>
                </div>
                
                <div class="map-section">
                    <h3><i class="fas fa-globe"></i> Interactive Map</h3>
                    <div id="map" class="map-container"></div>
                    <div class="map-instructions">
                        <p><i class="fas fa-info-circle"></i> Click on the map to select coordinates, or enter them manually above.</p>
                    </div>
                </div>
            </div>
            
            <!-- Location Analysis Loading -->
            <div id="location-loading" class="location-loading" style="display: none;">
                <div class="loading-content">
                    <i class="fas fa-satellite fa-spin"></i>
                    <p>Fetching satellite imagery and analyzing for deforestation...</p>
                    <div class="loading-details">
                        <p><small>This may take 10-30 seconds depending on the location and zoom level.</small></p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Upload Section -->
    <section id="upload" class="upload-section">
        <div class="container">
            <h2><i class="fas fa-satellite"></i> Upload Satellite Imagery</h2>
            <div class="upload-container">
                <form action="/" method="POST" enctype="multipart/form-data" class="upload-form">
                    <div class="file-upload">
                        <input type="file" name="file" id="file-input" accept="image/*" required>
                        <label for="file-input">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <span>Choose a file</span>
                        </label>
                        <p id="file-name" class="file-name">No file selected</p>
                    </div>
                    <button type="submit" class="btn primary-btn"><i class="fas fa-search"></i> Analyze Image</button>
                </form>
            </div>

            {% if uploaded_image %}
            <div class="results-container">
                <h2 class="results-title">Analysis Results</h2>
                <div class="result-badge {% if 'Deforestation Detected' in result %}warning{% else %}success{% endif %}">
                    <i class="fas {% if 'Deforestation Detected' in result %}fa-exclamation-triangle{% else %}fa-check-circle{% endif %}"></i>
                    {{ result }}
                </div>
                
                {% if confidence %}
                <div class="confidence-score">
                    <h3><i class="fas fa-chart-bar"></i> Model Confidence</h3>
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: {{ (confidence * 100)|round(1) }}%"></div>
                    </div>
                    <p>{{ (confidence * 100)|round(1) }}% confidence</p>
                </div>
                {% endif %}

                <!-- Deforestation Statistics Section -->
                {% if statistics %}
                <div class="deforestation-statistics">
                    <h2><i class="fas fa-chart-pie"></i> Deforestation Statistics & Analysis</h2>
                    
                    <div class="statistics-grid">
                        <!-- Location Information -->
                        <div class="stat-section">
                            <h3><i class="fas fa-map-marker-alt"></i> Location Information</h3>
                            <div class="stat-items">
                                <div class="stat-item">
                                    <span class="stat-label">Region:</span>
                                    <span class="stat-value">{{ statistics.region_name }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Coordinates:</span>
                                    <span class="stat-value">{{ statistics.coordinates }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Analysis Area:</span>
                                    <span class="stat-value">{{ statistics.analysis_area_km2 }} kmÂ² ({{ statistics.analysis_area_hectares }} hectares)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Deforestation Analysis -->
                        <div class="stat-section">
                            <h3><i class="fas fa-exclamation-triangle"></i> Deforestation Analysis</h3>
                            <div class="stat-items">
                                <div class="stat-item">
                                    <span class="stat-label">Local Deforestation:</span>
                                    <span class="stat-value deforestation-percentage">{{ statistics.local_deforestation_percentage }}%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Regional Average:</span>
                                    <span class="stat-value">{{ statistics.regional_deforestation_percentage }}%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Affected Area:</span>
                                    <span class="stat-value">{{ statistics.deforested_area_hectares }} hectares ({{ statistics.deforested_area_km2 }} kmÂ²)</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Priority Level:</span>
                                    <span class="stat-value priority-{{ statistics.priority.lower() }}">{{ statistics.priority }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tree Loss & Restoration -->
                        <div class="stat-section">
                            <h3><i class="fas fa-tree"></i> Tree Loss & Restoration Needs</h3>
                            <div class="stat-items">
                                <div class="stat-item">
                                    <span class="stat-label">Estimated Trees Lost:</span>
                                    <span class="stat-value trees-lost">{{ "{:,}".format(statistics.trees_lost) }} trees</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Trees Needed (Immediate):</span>
                                    <span class="stat-value">{{ "{:,}".format(statistics.trees_needed_immediate) }} trees</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Trees Needed (With Buffer):</span>
                                    <span class="stat-value">{{ "{:,}".format(statistics.trees_needed_buffer) }} trees</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Trees per Hectare:</span>
                                    <span class="stat-value">{{ statistics.trees_per_hectare }} trees/hectare</span>
                                </div>
                            </div>
                        </div>

                        <!-- Environmental Impact -->
                        <div class="stat-section">
                            <h3><i class="fas fa-leaf"></i> Environmental Impact</h3>
                            <div class="stat-items">
                                <div class="stat-item">
                                    <span class="stat-label">COâ‚‚ Impact:</span>
                                    <span class="stat-value co2-impact">{{ statistics.co2_impact_tons }} tons COâ‚‚/year</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Original Forest Coverage:</span>
                                    <span class="stat-value">{{ statistics.original_coverage }}%</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Current Forest Coverage:</span>
                                    <span class="stat-value">{{ statistics.current_coverage }}%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Restoration Plan -->
                        <div class="stat-section">
                            <h3><i class="fas fa-seedling"></i> Restoration Plan</h3>
                            <div class="stat-items">
                                <div class="stat-item">
                                    <span class="stat-label">Estimated Timeline:</span>
                                    <span class="stat-value">{{ statistics.restoration_years }}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Estimated Cost:</span>
                                    <span class="stat-value cost-estimate">${{ "{:,.2f}".format(statistics.reforestation_cost) }} USD</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Cost per Tree:</span>
                                    <span class="stat-value">$2.50 USD (including maintenance)</span>
                                </div>
                            </div>
                        </div>

                        <!-- Action Recommendations -->
                        <div class="stat-section full-width">
                            <h3><i class="fas fa-clipboard-list"></i> Immediate Action Recommendations</h3>
                            <div class="action-recommendations">
                                {% if statistics.priority == 'Critical' %}
                                <div class="recommendation critical">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <strong>Critical Priority:</strong> Immediate intervention required. Deploy emergency reforestation teams and establish protective barriers.
                                </div>
                                {% elif statistics.priority == 'High' %}
                                <div class="recommendation high">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>High Priority:</strong> Schedule reforestation within 3-6 months. Monitor area for further degradation.
                                </div>
                                {% elif statistics.priority == 'Medium' %}
                                <div class="recommendation medium">
                                    <i class="fas fa-info-circle"></i>
                                    <strong>Medium Priority:</strong> Plan reforestation within 6-12 months. Implement preventive measures.
                                </div>
                                {% else %}
                                <div class="recommendation low">
                                    <i class="fas fa-check-circle"></i>
                                    <strong>Low Priority:</strong> Monitor area and implement gradual restoration measures.
                                </div>
                                {% endif %}
                                
                                <div class="recommendation-details">
                                    <p><strong>Recommended Actions:</strong></p>
                                    <ul>
                                        <li>Plant {{ "{:,}".format(statistics.trees_needed_buffer) }} native tree species</li>
                                        <li>Establish {{ statistics.analysis_area_hectares }} hectares of protected zone</li>
                                        <li>Implement soil restoration measures</li>
                                        <li>Set up monitoring stations for ongoing surveillance</li>
                                        <li>Engage local communities in conservation efforts</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="result-images">
                    <div class="result-image-card">
                        <h3><i class="fas fa-image"></i> Original Image</h3>
                        <div class="image-container">
                            <img src="{{ uploaded_image }}" alt="Uploaded Image">
                        </div>
                    </div>
                    
                    {% if mask %}
                    <div class="result-image-card">
                        <h3><i class="fas fa-layer-group"></i> Deforestation Mask</h3>
                        <div class="image-container">
                            <img src="{{ mask }}" alt="Deforestation Mask">
                        </div>
                    </div>
                    
                    <div class="result-image-card">
                        <h3><i class="fas fa-map"></i> Visualization Overlay</h3>
                        <div class="image-container">
                            <img src="{{ output }}" alt="Visualization Overlay">
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- AI Analytics Button -->
                {% if show_ai_button %}
                <div class="ai-analytics-section">
                    <h2><i class="fas fa-brain"></i> Get AI-Powered Insights</h2>
                    <p>Get detailed environmental analysis and solutions from our AI assistant.</p>
                    <button id="get-ai-analytics" class="btn primary-btn">
                        <i class="fas fa-robot"></i> Get AI Analytics
                    </button>
                    <div id="loading-spinner" class="loading-spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Getting AI insights...
                    </div>
                </div>
                {% endif %}

                <!-- AI Results Container (Initially Hidden) -->
                <div id="ai-results-container" style="display: none;">
                    <!-- AI-Powered Analytics Section -->
                    <div class="ai-insights-section">
                        <h2><i class="fas fa-brain"></i> AI-Powered Environmental Analysis</h2>
                        <div class="insights-grid">
                            <div class="insight-card">
                                <h3><i class="fas fa-chart-line"></i> Environmental Impact Assessment</h3>
                                <div class="insight-content" id="analytics-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Solutions Section -->
                    <div class="solutions-section" id="solutions-section" style="display: none;">
                        <h2><i class="fas fa-lightbulb"></i> Recommended Solutions</h2>
                        <div class="solutions-grid">
                            <div class="solution-card urgent">
                                <h3><i class="fas fa-exclamation-circle"></i> Immediate Actions Required</h3>
                                <div class="solution-content" id="solutions-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prevention Strategies -->
                    <div class="prevention-section">
                        <h2><i class="fas fa-shield-alt"></i> Prevention Strategies</h2>
                        <div class="prevention-grid">
                            <div class="prevention-card">
                                <h3><i class="fas fa-leaf"></i> Long-term Conservation</h3>
                                <div class="prevention-content" id="prevention-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-summary">
                    <h3><i class="fas fa-clipboard-list"></i> Technical Analysis Summary</h3>
                    <p>The image was analyzed using our ResNet50-based deep learning model trained on satellite imagery. 
                    {% if 'Deforestation Detected' in result %}
                        The model detected patterns consistent with deforestation activities. Red areas in the visualization highlight regions of concern.
                    {% else %}
                        The model did not detect significant patterns associated with deforestation in this image.
                    {% endif %}
                    </p>
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Location Results Section (Initially Hidden) -->
    <div id="location-results" class="location-results" style="display: none;">
        <div class="container">
            <div class="results-container">
                <h2 class="results-title">Location Analysis Results</h2>
                <div id="location-result-badge" class="result-badge">
                    <!-- Content will be loaded here -->
                </div>
                
                <div id="location-confidence" class="confidence-score" style="display: none;">
                    <h3><i class="fas fa-chart-bar"></i> Model Confidence</h3>
                    <div class="confidence-bar">
                        <div id="location-confidence-fill" class="confidence-fill"></div>
                    </div>
                    <p id="location-confidence-text"></p>
                </div>

                <!-- Location Statistics Section -->
                <div id="location-statistics" class="deforestation-statistics" style="display: none;">
                    <!-- Content will be loaded here -->
                </div>
                
                <div id="location-result-images" class="result-images">
                    <!-- Content will be loaded here -->
                </div>

                <!-- AI Analytics Button for Location -->
                <div class="ai-analytics-section">
                    <h2><i class="fas fa-brain"></i> Get AI-Powered Insights</h2>
                    <p>Get detailed environmental analysis and solutions from our AI assistant.</p>
                    <button id="get-location-ai-analytics" class="btn primary-btn">
                        <i class="fas fa-robot"></i> Get AI Analytics
                    </button>
                    <div id="location-loading-spinner" class="loading-spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Getting AI insights...
                    </div>
                </div>

                <!-- AI Results Container for Location (Initially Hidden) -->
                <div id="location-ai-results-container" style="display: none;">
                    <!-- Same structure as upload results -->
                    <div class="ai-insights-section">
                        <h2><i class="fas fa-brain"></i> AI-Powered Environmental Analysis</h2>
                        <div class="insights-grid">
                            <div class="insight-card">
                                <h3><i class="fas fa-chart-line"></i> Environmental Impact Assessment</h3>
                                <div class="insight-content" id="location-analytics-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="solutions-section" id="location-solutions-section" style="display: none;">
                        <h2><i class="fas fa-lightbulb"></i> Recommended Solutions</h2>
                        <div class="solutions-grid">
                            <div class="solution-card urgent">
                                <h3><i class="fas fa-exclamation-circle"></i> Immediate Actions Required</h3>
                                <div class="solution-content" id="location-solutions-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="prevention-section">
                        <h2><i class="fas fa-shield-alt"></i> Prevention Strategies</h2>
                        <div class="prevention-grid">
                            <div class="prevention-card">
                                <h3><i class="fas fa-leaf"></i> Long-term Conservation</h3>
                                <div class="prevention-content" id="location-prevention-content">
                                    <!-- Content will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-summary">
                    <h3><i class="fas fa-clipboard-list"></i> Technical Analysis Summary</h3>
                    <p id="location-analysis-summary">
                        <!-- Content will be loaded here -->
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-tree"></i> ForestGuard AI
            </div>
            <div class="footer-links">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="#">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#location-analysis">Location</a></li>
                    <li><a href="#upload">Upload</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </div>
            <div class="footer-contact">
                <h3>Contact Us</h3>
                <p><i class="fas fa-envelope"></i> info@forestguard-ai.com</p>
                <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                    <a href="#"><i class="fab fa-github"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ForestGuard AI | All Rights Reserved</p>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Global variables
        let map;
        let marker;

        // Theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const themeSwitch = document.getElementById('theme-switch');
            const html = document.documentElement;
            
            // Check for saved theme preference or use default dark theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            html.setAttribute('data-theme', savedTheme);
            
            themeSwitch.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
            
            // File upload name display
            const fileInput = document.getElementById('file-input');
            const fileName = document.getElementById('file-name');
            
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    if (fileInput.files.length > 0) {
                        fileName.textContent = fileInput.files[0].name;
                    } else {
                        fileName.textContent = 'No file selected';
                    }
                });
            }
            
            // Mobile menu toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const nav = document.querySelector('nav');
            
            mobileMenuBtn.addEventListener('click', function() {
                nav.classList.toggle('mobile-active');
            });

            // Initialize map
            initializeMap();

            // Location analysis functionality
            setupLocationAnalysis();

            // AI Analytics button functionality
            setupAIAnalytics();
        });

        function initializeMap() {
            // Initialize the map
            map = L.map('map').setView([-3.4653, -62.2159], 6); // Amazon rainforest center

            // Add tile layer with satellite imagery
            L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Â© Esri, Maxar, Earthstar Geographics',
                maxZoom: 18
            }).addTo(map);

            // Add click event to map
            map.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(6);
                const lon = e.latlng.lng.toFixed(6);
                
                // Update input fields
                document.getElementById('latitude').value = lat;
                document.getElementById('longitude').value = lon;
                
                // Update marker
                updateMapMarker(lat, lon);
            });
        }

        function updateMapMarker(lat, lon) {
            // Remove existing marker
            if (marker) {
                map.removeLayer(marker);
            }
            
            // Add new marker
            marker = L.marker([lat, lon]).addTo(map);
            
            // Center map on marker
            map.setView([lat, lon], Math.max(map.getZoom(), 10));
        }

        function setupLocationAnalysis() {
            // Show on map button
            document.getElementById('show-on-map').addEventListener('click', function() {
                const lat = parseFloat(document.getElementById('latitude').value);
                const lon = parseFloat(document.getElementById('longitude').value);
                
                if (isNaN(lat) || isNaN(lon)) {
                    alert('Please enter valid coordinates');
                    return;
                }
                
                if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                    alert('Please enter valid coordinates:\nLatitude: -90 to 90\nLongitude: -180 to 180');
                    return;
                }
                
                updateMapMarker(lat, lon);
            });

            // Analyze location button
            document.getElementById('analyze-location').addEventListener('click', function() {
                const lat = parseFloat(document.getElementById('latitude').value);
                const lon = parseFloat(document.getElementById('longitude').value);
                const zoom = parseInt(document.getElementById('zoom-level').value);
                
                if (isNaN(lat) || isNaN(lon)) {
                    alert('Please enter valid coordinates');
                    return;
                }
                
                if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                    alert('Please enter valid coordinates:\nLatitude: -90 to 90\nLongitude: -180 to 180');
                    return;
                }
                
                analyzeLocation(lat, lon, zoom);
            });

            // Quick location buttons
            document.querySelectorAll('.quick-location-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lat = parseFloat(this.dataset.lat);
                    const lon = parseFloat(this.dataset.lon);
                    
                    document.getElementById('latitude').value = lat;
                    document.getElementById('longitude').value = lon;
                    
                    updateMapMarker(lat, lon);
                });
            });
        }

        function analyzeLocation(lat, lon, zoom) {
            // Show loading
            document.getElementById('location-loading').style.display = 'block';
            
            // Hide previous results
            document.getElementById('location-results').style.display = 'none';
            
            // Scroll to loading section
            document.getElementById('location-loading').scrollIntoView({ behavior: 'smooth' });
            
            console.log(`Analyzing location: lat=${lat}, lon=${lon}, zoom=${zoom}`);
            
            // Make API call
            fetch('/analyze_location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    lat: lat,
                    lon: lon,
                    zoom: zoom
                })
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                document.getElementById('location-loading').style.display = 'none';
                
                if (data.success) {
                    displayLocationResults(data);
                } else {
                    alert('Error: ' + data.error);
                    console.error('Analysis error:', data.error);
                }
            })
            .catch(error => {
                document.getElementById('location-loading').style.display = 'none';
                console.error('Network error:', error);
                alert('Network error analyzing location. Please check your connection and try again.');
            });
        }

        function displayLocationResults(data) {
            console.log('Displaying location results:', data);
            
            // Update result badge
            const badge = document.getElementById('location-result-badge');
            badge.className = `result-badge ${data.deforestation_detected ? 'warning' : 'success'}`;
            badge.innerHTML = `
                <i class="fas ${data.deforestation_detected ? 'fa-exclamation-triangle' : 'fa-check-circle'}"></i>
                ${data.deforestation_detected ? 'ðŸ›‘ Deforestation Detected!' : 'âœ… No Deforestation Detected!'}
            `;
            
            // Update confidence score
            if (data.confidence !== undefined) {
                const confidenceSection = document.getElementById('location-confidence');
                const confidenceFill = document.getElementById('location-confidence-fill');
                const confidenceText = document.getElementById('location-confidence-text');
                
                confidenceSection.style.display = 'block';
                confidenceFill.style.width = `${(data.confidence * 100).toFixed(1)}%`;
                confidenceText.textContent = `${(data.confidence * 100).toFixed(1)}% confidence`;
            }

            // Update statistics section
            if (data.statistics) {
                displayLocationStatistics(data.statistics);
            }
            
            // Update result images
            const imagesContainer = document.getElementById('location-result-images');
            let imagesHTML = `
                <div class="result-image-card">
                    <h3><i class="fas fa-satellite"></i> Satellite Image</h3>
                    <div class="image-container">
                        <img src="${data.original}" alt="Satellite Image" onerror="this.style.display='none'">
                    </div>
                </div>
            `;
            
            if (data.mask && data.output) {
                imagesHTML += `
                    <div class="result-image-card">
                        <h3><i class="fas fa-layer-group"></i> Deforestation Mask</h3>
                        <div class="image-container">
                            <img src="${data.mask}" alt="Deforestation Mask" onerror="this.style.display='none'">
                        </div>
                    </div>
                    <div class="result-image-card">
                        <h3><i class="fas fa-map"></i> Visualization Overlay</h3>
                        <div class="image-container">
                            <img src="${data.output}" alt="Visualization Overlay" onerror="this.style.display='none'">
                        </div>
                    </div>
                `;
            }
            
            imagesContainer.innerHTML = imagesHTML;
            
            // Update analysis summary
            const summaryElement = document.getElementById('location-analysis-summary');
            if (summaryElement) {
                summaryElement.innerHTML = `
                    The satellite image from coordinates ${data.location} was analyzed using our ResNet50-based deep learning model. 
                    ${data.deforestation_detected ? 
                        'The model detected patterns consistent with deforestation activities. Red areas in the visualization highlight regions of concern.' : 
                        'The model did not detect significant patterns associated with deforestation in this location.'
                    }
                    ${data.message ? '<br><br>' + data.message : ''}
                `;
            }
            
            // Show results section
            document.getElementById('location-results').style.display = 'block';
            
            // Scroll to results
            setTimeout(() => {
                document.getElementById('location-results').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function displayLocationStatistics(statistics) {
            const statisticsContainer = document.getElementById('location-statistics');
            
            const statisticsHTML = `
                <h2><i class="fas fa-chart-pie"></i> Deforestation Statistics & Analysis</h2>
                
                <div class="statistics-grid">
                    <!-- Location Information -->
                    <div class="stat-section">
                        <h3><i class="fas fa-map-marker-alt"></i> Location Information</h3>
                        <div class="stat-items">
                            <div class="stat-item">
                                <span class="stat-label">Region:</span>
                                <span class="stat-value">${statistics.region_name}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Coordinates:</span>
                                <span class="stat-value">${statistics.coordinates}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Analysis Area:</span>
                                <span class="stat-value">${statistics.analysis_area_km2} kmÂ² (${statistics.analysis_area_hectares} hectares)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Deforestation Analysis -->
                    <div class="stat-section">
                        <h3><i class="fas fa-exclamation-triangle"></i> Deforestation Analysis</h3>
                        <div class="stat-items">
                            <div class="stat-item">
                                <span class="stat-label">Local Deforestation:</span>
                                <span class="stat-value deforestation-percentage">${statistics.local_deforestation_percentage}%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Regional Average:</span>
                                <span class="stat-value">${statistics.regional_deforestation_percentage}%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Affected Area:</span>
                                <span class="stat-value">${statistics.deforested_area_hectares} hectares (${statistics.deforested_area_km2} kmÂ²)</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Priority Level:</span>
                                <span class="stat-value priority-${statistics.priority.toLowerCase()}">${statistics.priority}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tree Loss & Restoration -->
                    <div class="stat-section">
                        <h3><i class="fas fa-tree"></i> Tree Loss & Restoration Needs</h3>
                        <div class="stat-items">
                            <div class="stat-item">
                                <span class="stat-label">Estimated Trees Lost:</span>
                                <span class="stat-value trees-lost">${statistics.trees_lost.toLocaleString()} trees</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Trees Needed (Immediate):</span>
                                <span class="stat-value">${statistics.trees_needed_immediate.toLocaleString()} trees</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Trees Needed (With Buffer):</span>
                                <span class="stat-value">${statistics.trees_needed_buffer.toLocaleString()} trees</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Trees per Hectare:</span>
                                <span class="stat-value">${statistics.trees_per_hectare} trees/hectare</span>
                            </div>
                        </div>
                    </div>

                    <!-- Environmental Impact -->
                    <div class="stat-section">
                        <h3><i class="fas fa-leaf"></i> Environmental Impact</h3>
                        <div class="stat-items">
                            <div class="stat-item">
                                <span class="stat-label">COâ‚‚ Impact:</span>
                                <span class="stat-value co2-impact">${statistics.co2_impact_tons} tons COâ‚‚/year</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Original Forest Coverage:</span>
                                <span class="stat-value">${statistics.original_coverage}%</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Current Forest Coverage:</span>
                                <span class="stat-value">${statistics.current_coverage}%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Restoration Plan -->
                    <div class="stat-section">
                        <h3><i class="fas fa-seedling"></i> Restoration Plan</h3>
                        <div class="stat-items">
                            <div class="stat-item">
                                <span class="stat-label">Estimated Timeline:</span>
                                <span class="stat-value">${statistics.restoration_years}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Estimated Cost:</span>
                                <span class="stat-value cost-estimate">$${statistics.reforestation_cost.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})} USD</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Cost per Tree:</span>
                                <span class="stat-value">$2.50 USD (including maintenance)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Recommendations -->
                    <div class="stat-section full-width">
                        <h3><i class="fas fa-clipboard-list"></i> Immediate Action Recommendations</h3>
                        <div class="action-recommendations">
                            ${getRecommendationHTML(statistics)}
                            
                            <div class="recommendation-details">
                                <p><strong>Recommended Actions:</strong></p>
                                <ul>
                                    <li>Plant ${statistics.trees_needed_buffer.toLocaleString()} native tree species</li>
                                    <li>Establish ${statistics.analysis_area_hectares} hectares of protected zone</li>
                                    <li>Implement soil restoration measures</li>
                                    <li>Set up monitoring stations for ongoing surveillance</li>
                                    <li>Engage local communities in conservation efforts</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            statisticsContainer.innerHTML = statisticsHTML;
            statisticsContainer.style.display = 'block';
        }

        function getRecommendationHTML(statistics) {
            const priority = statistics.priority;
            
            if (priority === 'Critical') {
                return `
                    <div class="recommendation critical">
                        <i class="fas fa-exclamation-circle"></i>
                        <strong>Critical Priority:</strong> Immediate intervention required. Deploy emergency reforestation teams and establish protective barriers.
                    </div>
                `;
            } else if (priority === 'High') {
                return `
                    <div class="recommendation high">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>High Priority:</strong> Schedule reforestation within 3-6 months. Monitor area for further degradation.
                    </div>
                `;
            } else if (priority === 'Medium') {
                return `
                    <div class="recommendation medium">
                        <i class="fas fa-info-circle"></i>
                        <strong>Medium Priority:</strong> Plan reforestation within 6-12 months. Implement preventive measures.
                    </div>
                `;
            } else {
                return `
                    <div class="recommendation low">
                        <i class="fas fa-check-circle"></i>
                        <strong>Low Priority:</strong> Monitor area and implement gradual restoration measures.
                    </div>
                `;
            }
        }

        function setupAIAnalytics() {
            // Upload AI Analytics button
            const getAiAnalyticsBtn = document.getElementById('get-ai-analytics');
            const loadingSpinner = document.getElementById('loading-spinner');
            const aiResultsContainer = document.getElementById('ai-results-container');

            if (getAiAnalyticsBtn) {
                getAiAnalyticsBtn.addEventListener('click', function() {
                    getAIInsights(getAiAnalyticsBtn, loadingSpinner, aiResultsContainer, 'analytics-content', 'solutions-content', 'prevention-content', 'solutions-section');
                });
            }

            // Location AI Analytics button
            const getLocationAiAnalyticsBtn = document.getElementById('get-location-ai-analytics');
            const locationLoadingSpinner = document.getElementById('location-loading-spinner');
            const locationAiResultsContainer = document.getElementById('location-ai-results-container');

            if (getLocationAiAnalyticsBtn) {
                getLocationAiAnalyticsBtn.addEventListener('click', function() {
                    getAIInsights(getLocationAiAnalyticsBtn, locationLoadingSpinner, locationAiResultsContainer, 'location-analytics-content', 'location-solutions-content', 'location-prevention-content', 'location-solutions-section');
                });
            }
        }

        function getAIInsights(button, spinner, container, analyticsId, solutionsId, preventionId, solutionsSectionId) {
            // Show loading spinner and hide button
            button.style.display = 'none';
            spinner.style.display = 'block';

            // Make API call to get AI analytics
            fetch('/get_ai_analytics', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                spinner.style.display = 'none';
                
                if (data.success) {
                    // Populate the content
                    if (data.analytics) {
                        document.getElementById(analyticsId).innerHTML = 
                            data.analytics.replace(/\n/g, '<br>').replace(/â€¢/g, '<span class="bullet">â€¢</span>');
                    }
                    
                    if (data.solutions) {
                        document.getElementById(solutionsId).innerHTML = 
                            data.solutions.replace(/\n/g, '<br>').replace(/â€¢/g, '<span class="bullet">â€¢</span>');
                        document.getElementById(solutionsSectionId).style.display = 'block';
                    }
                    
                    if (data.prevention_strategies) {
                        document.getElementById(preventionId).innerHTML = 
                            data.prevention_strategies.replace(/\n/g, '<br>').replace(/â€¢/g, '<span class="bullet">â€¢</span>');
                    }
                    
                    // Show the results container
                    container.style.display = 'block';
                    
                    // Scroll to results
                    container.scrollIntoView({ behavior: 'smooth' });
                } else {
                    // Show error message
                    button.style.display = 'block';
                    alert('Error getting AI insights: ' + data.error);
                }
            })
            .catch(error => {
                spinner.style.display = 'none';
                button.style.display = 'block';
                console.error('Error:', error);
                alert('Error getting AI insights. Please try again.');
            });
        }
    </script>
</body>
</html>